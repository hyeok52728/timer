<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>모의수사경진대회 시각 타이머 (Left + 정수초 + 세부 보정)</title>
<style>
  *{box-sizing:border-box}
  :root{
    --bg:#000; --fg:#fff; --chip:#8f8f8f; --panel:#121212; --btn:#7f7f7f; --btn2:#2b2b2b;
    --stage-max:1200px; --scale:1;
  }
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--fg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
    display:block; overflow-x:hidden; padding-top:16px;
  }
  .stage{ width:min(var(--stage-max), 98vw); margin-left:clamp(12px,2vw,36px); margin-right:auto; padding:8px 0 24px; }
  .grid{ display:grid; gap:28px; align-items:start; }
  .grid.two{ grid-template-columns:1.6fr .9fr; }
  @media (max-width:880px){ .grid.two{ grid-template-columns:1fr; gap:20px } }

  .titlechip{ background:var(--chip); color:#111; font-weight:800; letter-spacing:.08em; padding:10px 14px; border-radius:10px; text-align:center; width:100% }
  .panel{ background:var(--panel); border-radius:18px; padding:18px 22px; box-shadow:0 10px 30px rgba(0,0,0,.35) }

  .datebig{ font-size:clamp(calc(28px*var(--scale)), calc(6.5vw*var(--scale)), calc(80px*var(--scale)));
            font-weight:800; letter-spacing:.02em; margin:6px 0 10px; color:#dfe6ff; text-align:center; }
  .timebig{ font-size:clamp(calc(80px*var(--scale)), calc(17vw*var(--scale)), calc(220px*var(--scale)));
            font-weight:900; line-height:1; letter-spacing:.02em; text-align:center; word-break:keep-all; }
  .datesm{ font-size:clamp(calc(16px*var(--scale)), calc(2.6vw*var(--scale)), calc(26px*var(--scale)));
           color:#dfe6ff; margin:8px 0 6px; text-align:center; }
  .timesm{ font-size:clamp(calc(40px*var(--scale)), calc(8vw*var(--scale)), calc(90px*var(--scale)));
           font-weight:800; line-height:1.1; text-align:center; }
  .note{ margin-top:10px; color:#c5c5c5; font-size:12px; text-align:center; }

  .controls{ display:flex; gap:8px; justify-content:flex-start; margin-top:12px; flex-wrap:wrap }
  .btn{ cursor:pointer; border:0; border-radius:12px; background:var(--btn); color:#111; font-weight:800; padding:10px 14px }
  .btn.alt{ background:var(--btn2); color:#eaeaea; border:1px solid #333 }
  .btn:active{ transform:translateY(1px) }

  .modal{ position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.55) }
  .modal.open{ display:grid }
  .sheet{ width:min(860px,96vw); background:#0e0e0e; color:#eee; border:1px solid #242424; border-radius:16px; padding:18px }
  .rows{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
  @media (max-width:680px){ .rows{ grid-template-columns:1fr } }
  .card{ background:#131313; border:1px solid #242424; border-radius:12px; padding:12px }
  .card h4{ margin:0 0 8px; color:#c9d4ff; font-size:14px; letter-spacing:.06em }
  .pad{ display:grid; grid-template-columns:repeat(5,1fr); gap:8px }
  .pad button{ border:1px solid #2b2b2b; background:#202020; color:#dfe6ff; border-radius:10px; padding:10px 8px; font-weight:700; cursor:pointer }
  .pad button:hover{ background:#2a2a2a }
  .legend{ font-size:12px; color:#aaa; margin-top:6px }
  .footer{ display:flex; gap:8px; justify-content:space-between; margin-top:12px; flex-wrap:wrap }

  .formrow{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px }
  .formrow input[type="date"], .formrow input[type="time"]{
    background:#202020; color:#eaeaea; border:1px solid #2b2b2b; border-radius:8px; padding:8px 10px;
  }
</style>
</head>
<body>
  <div class="stage">
    <div class="grid two">
      <section>
        <div class="titlechip">모의수사경진대회 시각</div>
        <div class="panel">
          <div class="datebig" id="vDate">XXXX-XX-XX</div>
          <!-- 정수초 표기 -->
          <div class="timebig" id="vTime">00:00:00</div>
          <div class="note" id="vMeta"></div>
        </div>
      </section>

      <aside>
        <div class="titlechip">실제 시각</div>
        <div class="panel">
          <div class="datesm" id="rDate">XXXX-XX-XX</div>
          <div class="timesm" id="rTime">00:00:00</div>
        </div>
        <div class="controls">
          <button class="btn" id="openAdjust">일시 조정</button>
          <button class="btn alt" id="fullBtn">⛶ 전체화면</button>
        </div>
      </aside>
    </div>
  </div>

  <!-- 일시 조정 모달 -->
  <div class="modal" id="modalTime">
    <div class="sheet">
      <h3 style="margin:4px 0 12px">일시 조정</h3>

      <div class="rows">
        <div class="card">
          <h4>현실 기준 시작 (기본: 오늘 20:00, 이전이면 어제 20:00)</h4>
          <div class="pad">
            <button data-real="+1d">+1일</button><button data-real="-1d">-1일</button>
            <button data-real="+1h">+1시간</button><button data-real="-1h">-1시간</button>
            <button data-real="reset">초기화</button>
            <button data-real="+1m">+1분</button><button data-real="-1m">-1분</button>
          </div>
          <div class="legend" id="realLegend">기준: —</div>
        </div>

        <div class="card">
          <h4>가상 기준 시작 (기본: 같은 날 09:00)</h4>
          <div class="pad">
            <button data-virt="+1d">+1일</button><button data-virt="-1d">-1일</button>
            <button data-virt="+1h">+1시간</button><button data-virt="-1h">-1시간</button>
            <button data-virt="reset">초기화</button>
            <button data-virt="+1m">+1분</button><button data-virt="-1m">-1분</button>
          </div>
          <div class="legend" id="virtLegend">기준: —</div>
        </div>
      </div>

      <!-- ★ 경진대회 시각(현재) 보정 추가 -->
      <div class="card" style="margin-top:12px">
        <h4>경진대회 시각(현재) 보정</h4>
        <div class="legend">현재 화면의 대회 시각을 기준으로 <b>하루/시간/분</b> 단위로 보정하거나, 아래 입력값으로 바로 맞춥니다.</div>

        <div class="pad" style="grid-template-columns:repeat(7,1fr); margin-top:8px">
          <button data-vadj="+1d">+1일</button><button data-vadj="-1d">-1일</button>
          <button data-vadj="+1h">+1시간</button><button data-vadj="-1h">-1시간</button>
          <button data-vadj="+10m">+10분</button><button data-vadj="+1m">+1분</button><button data-vadj="-1m">-1분</button>
        </div>

        <div class="formrow">
          <div class="legend">현재 대회 시각: <span id="vNowLive">—</span></div>
        </div>
        <div class="formrow">
          <label>날짜</label><input type="date" id="vDateInput">
          <label>시간</label><input type="time" id="vTimeInput" step="1">
          <button class="btn alt" id="applyVTarget">지금 시각을 이 값으로 맞춤</button>
          <button class="btn alt" id="resetVAdj">보정 초기화</button>
        </div>
        <div class="legend" id="virtAdjLegend">보정: +0일 00:00:00</div>
      </div>

      <div class="card" style="margin-top:12px">
        <h4>배율 (현실 → 가상)</h4>
        <div class="pad" style="grid-template-columns:repeat(6,1fr)">
          <button data-speed="1">×1</button><button data-speed="2">×2</button>
          <button data-speed="3">×3</button><button data-speed="4">×4</button>
          <button data-speed="6">×6</button><button data-speed="9">×9</button>
        </div>
        <div class="legend" id="speedLegend">현재 배율: ×3</div>
      </div>

      <div class="footer">
        <button class="btn alt" id="closeTime">닫기</button>
        <button class="btn alt" id="hardReset">모두 초기화</button>
      </div>
    </div>
  </div>

<script>
  /* ===== 기본 설정 ===== */
  const REAL_BASE_HMS = { h:20, m:0, s:0 };
  const VIRT_BASE_HMS = { h:9,  m:0, s:0 };
  let SPEED = 3;

  /* ===== 상태 ===== */
  let realBase, virtBase, realBaseInit, virtBaseInit;
  let virtAdjustMs = 0; // 경진대회 시각(현재) 보정량 (ms)

  /* ===== 유틸 ===== */
  const pad = n => String(n).padStart(2,'0');
  const fmtDate = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  const fmtHMS  = d => `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
  const add = (d,{dys=0,hrs=0,mins=0}) => new Date(d.getTime() + (dys*864e5 + hrs*3600e3 + mins*60e3));

  function getDefaultRealBase(now=new Date()){
    const base = new Date(now);
    base.setHours(REAL_BASE_HMS.h, REAL_BASE_HMS.m, REAL_BASE_HMS.s, 0);
    if (now < base) base.setDate(base.getDate()-1);
    return base;
  }
  function getDefaultVirtBase(realBase){
    const v = new Date(realBase);
    v.setHours(VIRT_BASE_HMS.h, VIRT_BASE_HMS.m, VIRT_BASE_HMS.s, 0);
    return v;
  }
  function computeVirtual(nowMs){
    // 가상 = 가상 기준 + (현실경과 × 배율) + 보정
    return new Date(virtBase.getTime() + (nowMs - realBase.getTime()) * SPEED + virtAdjustMs);
  }

  /* ===== 초기화 ===== */
  function initialize(){
    const now = new Date();
    realBase = getDefaultRealBase(now);
    virtBase = getDefaultVirtBase(realBase);
    realBaseInit = new Date(realBase.getTime());
    virtBaseInit = new Date(virtBase.getTime());
    virtAdjustMs = 0;
    updateLegends();
  }

  /* ===== 요소 ===== */
  const elVDate=document.getElementById('vDate'), elVTime=document.getElementById('vTime'),
        elVMeta=document.getElementById('vMeta'), elRDate=document.getElementById('rDate'),
        elRTime=document.getElementById('rTime'), elSpeedLegend=document.getElementById('speedLegend'),
        elRealLegend=document.getElementById('realLegend'), elVirtLegend=document.getElementById('virtLegend'),
        elVirtAdjLegend=document.getElementById('virtAdjLegend'),
        elVNowLive=document.getElementById('vNowLive'),
        vDateInput=document.getElementById('vDateInput'), vTimeInput=document.getElementById('vTimeInput');

  /* ===== 렌더 루프 (정수초 표시) ===== */
  function render(){
    const nowMs = Date.now();
    const realNow = new Date(nowMs);
    elRDate.textContent = fmtDate(realNow);
    elRTime.textContent = fmtHMS(realNow);

    const vNow = computeVirtual(nowMs);
    elVDate.textContent = fmtDate(vNow);
    elVTime.textContent = fmtHMS(vNow);               // 정수초만
    elVMeta.textContent = `기준(현실 ${fmtHMS(realBase)}) → (가상 ${fmtHMS(virtBase)}) · 배율 ×${SPEED}`;

    // 모달에 현재 대회 시각 라이브 표기
    if (elVNowLive) elVNowLive.textContent = `${fmtDate(vNow)} ${fmtHMS(vNow)}`;

    requestAnimationFrame(render);
  }

  /* ===== 보조 표기 ===== */
  function fmtAdj(ms){
    let sign = ms>=0 ? '+' : '-';
    let a = Math.abs(ms);
    const d = Math.floor(a/86400000); a%=86400000;
    const h = Math.floor(a/3600000);  a%=3600000;
    const m = Math.floor(a/60000);    a%=60000;
    const s = Math.floor(a/1000);
    return `${sign}${d}일 ${pad(h)}:${pad(m)}:${pad(s)}`;
  }
  function updateLegends(){
    elRealLegend.textContent = `기준: ${fmtDate(realBase)} ${fmtHMS(realBase)}`;
    elVirtLegend.textContent = `기준: ${fmtDate(virtBase)} ${fmtHMS(virtBase)}`;
    elSpeedLegend.textContent = `현재 배율: ×${SPEED}`;
    elVirtAdjLegend.textContent = `보정: ${fmtAdj(virtAdjustMs)}`;
  }

  /* ===== 모달 & 이벤트 ===== */
  const modalTime = document.getElementById('modalTime');
  document.getElementById('openAdjust').addEventListener('click', ()=>{
    // 입력창을 현재 대회 시각으로 프리셋
    const vNow = computeVirtual(Date.now());
    vDateInput.value = fmtDate(vNow);
    vTimeInput.value = fmtHMS(vNow);
    modalTime.classList.add('open');
    updateLegends();
  });
  document.getElementById('closeTime').addEventListener('click', ()=> modalTime.classList.remove('open'));

  document.getElementById('hardReset').addEventListener('click', ()=>{
    realBase = new Date(realBaseInit.getTime());
    virtBase = new Date(virtBaseInit.getTime());
    virtAdjustMs = 0;
    SPEED = 3;
    updateLegends();
  });

  // 버튼들 공통 처리
  document.addEventListener('click',(e)=>{
    const t=e.target; if(!(t instanceof HTMLButtonElement)) return;

    // 현실 기준
    if(t.dataset.real){
      const v=t.dataset.real;
      if(v==='reset') realBase=new Date(realBaseInit.getTime());
      else if(v==='+1d') realBase=add(realBase,{dys:+1});
      else if(v==='-1d') realBase=add(realBase,{dys:-1});
      else if(v==='+1h') realBase=add(realBase,{hrs:+1});
      else if(v==='-1h') realBase=add(realBase,{hrs:-1});
      else if(v==='+1m') realBase=add(realBase,{mins:+1});
      else if(v==='-1m') realBase=add(realBase,{mins:-1});
      updateLegends();
    }

    // 가상 기준
    if(t.dataset.virt){
      const v=t.dataset.virt;
      if(v==='reset') virtBase=new Date(virtBaseInit.getTime());
      else if(v==='+1d') virtBase=add(virtBase,{dys:+1});
      else if(v==='-1d') virtBase=add(virtBase,{dys:-1});
      else if(v==='+1h') virtBase=add(virtBase,{hrs:+1});
      else if(v==='-1h') virtBase=add(virtBase,{hrs:-1});
      else if(v==='+1m') virtBase=add(virtBase,{mins:+1});
      else if(v==='-1m') virtBase=add(virtBase,{mins:-1});
      updateLegends();
    }

    // 경진대회 시각(현재) 보정
    if(t.dataset.vadj){
      const map={'+1d':86400000,'-1d':-86400000,'+1h':3600000,'-1h':-3600000,'+10m':600000,'+1m':60000,'-1m':-60000};
      virtAdjustMs += (map[t.dataset.vadj]||0);
      updateLegends();
    }

    // 배율
    if(t.dataset.speed){ SPEED=Number(t.dataset.speed); updateLegends(); }
  });

  // 지정값으로 맞추기
  document.getElementById('applyVTarget').addEventListener('click', ()=>{
    if(!vDateInput.value || !vTimeInput.value) return;
    const target = new Date(`${vDateInput.value}T${vTimeInput.value}`);
    const nowMs = Date.now();
    const baseNoAdj = virtBase.getTime() + (nowMs - realBase.getTime()) * SPEED;
    virtAdjustMs = target.getTime() - baseNoAdj;
    updateLegends();
  });

  // 보정 초기화
  document.getElementById('resetVAdj').addEventListener('click', ()=>{
    virtAdjustMs = 0;
    updateLegends();
  });

  // 전체 화면
  document.getElementById('fullBtn').addEventListener('click', ()=>{
    const el = document.documentElement;
    if (!document.fullscreenElement) el.requestFullscreen?.();
    else document.exitFullscreen?.();
  });

  // 시작
  initialize();
  render();
</script>
</body>
</html>
